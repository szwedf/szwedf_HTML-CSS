/* ---------- Base ---------- */
:root{
  --bg:#0b0c0f;
  --panel:#11131a;
  --muted:#96a0af;
  --text:#e5e7eb;
  --accent:#4ade80;
  --accent-weak:#2dd4bf;
  --border:#1f2430;
  --shadow:0 8px 24px rgba(0,0,0,.4);
}

*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  margin:0;
  font-family:'Zen Kaku Gothic New', system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
  line-height:1.8;
  color:var(--text);
  background:linear-gradient(180deg, #0b0c0f, #0d1117 30%, #0b0c0f 100%);
}

/* Container */
.container{max-width:1080px; margin:auto; padding:0 20px}

/* ---------- Header / Nav ---------- */
.site-header{
  position:sticky; top:0; z-index:100;
  background:rgba(11,12,15,.85); backdrop-filter: blur(6px);
  border-bottom:1px solid var(--border);
}
.header-inner{display:flex; align-items:center; justify-content:space-between; min-height:64px}
.logo{font-size:20px; margin:0}

.nav{display:none}
.nav[aria-hidden="false"]{display:block}
.nav__list{list-style:none; margin:0; padding:12px 0; display:flex; gap:16px; flex-wrap:wrap}
.nav__link{
  display:inline-block; padding:8px 12px; border:1px solid var(--border);
  border-radius:10px; text-decoration:none; color:var(--text);
  transition:all .2s ease;
}
.nav__link:hover{border-color:var(--accent); color:white}

.nav-toggle{
  background:transparent; border:none; padding:8px; border-radius:10px;
  display:grid; gap:4px; cursor:pointer;
}
.nav-toggle__bar{width:24px; height:2px; background:var(--text); display:block}

@media(min-width:820px){
  .nav{display:block !important}
  .nav-toggle{display:none}
}

/* ---------- Hero ---------- */
.hero{
  display:grid; gap:24px; align-items:center;
  grid-template-columns: 1.05fr .95fr;
  padding:40px 0 8px;
}
.hero__title{font-size: clamp(22px, 2.6vw, 36px); margin:0 0 .2em}
.hero__lead{margin:0; color:var(--muted)}
.hero__media img{width:100%; height:auto; border-radius:16px; box-shadow:var(--shadow)}

@media(max-width:820px){
  .hero{grid-template-columns: 1fr}
}

/* ---------- TOC ---------- */
.toc{
  margin: 24px 0 8px;
  padding:16px;
  border:1px solid var(--border);
  border-radius:16px;
  background:var(--panel);
}
.toc__title{margin:0 0 8px; font-size:16px; color:#cbd5e1}
.toc__list{display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; margin:0; padding-left:18px}

/* ---------- Sections / Prose ---------- */
.section{margin:40px 0}
.prose{max-width:76ch}
.prose p{margin:.6em 0}
.prose .muted{color:var(--muted)}
.tip{
  padding:12px 14px; border:1px dashed var(--accent);
  border-radius:12px; background:#0e1420; color:#c7f9cc
}

/* ---------- Cards ---------- */
.cards{
  display:grid; gap:16px;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  box-shadow: var(--shadow);
}
.figure{margin:12px 0}
.figure--bleed img{width:100%; height:auto; border-radius:12px}
.figure--center{display:grid; place-items:center}
.figure--center img{border-radius:16px; box-shadow:var(--shadow)}

/* ---------- Grid ---------- */
.grid{display:grid; gap:12px}
.grid--2{grid-template-columns: repeat(auto-fit, minmax(280px, 1fr))}

/* ---------- Accordion (details) ---------- */
.accordion{border:1px solid var(--border); border-radius:12px; background:#0e1220; margin:10px 0}
.accordion > summary{
  cursor:pointer; user-select:none;
  padding:12px 14px; list-style:none; font-weight:600;
}
.accordion[open] > summary{border-bottom:1px solid var(--border)}
.accordion > *:not(summary){padding:12px 14px}

/* ---------- Video ---------- */
.video{
  position:relative; aspect-ratio:16/9; background:#0a0d13; border-radius:16px;
  overflow:hidden; border:1px solid var(--border); box-shadow:var(--shadow)
}
.video iframe{width:100%; height:100%; border:0; display:block}
.video-list{display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr))}

/* YouTube幅キャップ（JSが効かない場合でも強制） */
iframe[src*="youtube.com"], iframe[src*="youtube-nocookie.com"]{
  display:block; width:100%; max-width:min(840px,100%);
  aspect-ratio:16/9; height:auto; margin:12px auto; border:0; border-radius:16px; box-shadow:var(--shadow);
}

/* Lite埋め込み用の見た目（JSが注入できない場合でもここで整う） */
.yt-lite{
  position:relative; display:block; width:100%;
  max-width:min(840px, 100%); margin:12px auto;
  border:1px solid var(--border); border-radius:16px;
  overflow:hidden; aspect-ratio:16/9; background:#000; box-shadow:var(--shadow);
}
.video-list .yt-lite{ max-width:100%; margin:0; }
.yt-lite__play{
  position:absolute; inset:0; display:grid;
  grid-template-rows:1fr auto; place-items:center;
  width:100%; height:100%; background:transparent; border:0; cursor:pointer;
}
.yt-lite__thumb{ width:100%; height:100%; object-fit:cover; filter:brightness(.9); }
.yt-lite__icon{
  font-size:42px; line-height:1; background:rgba(0,0,0,.45);
  padding:.4em .6em; border-radius:999px; color:#fff; margin-bottom:8px;
}
.yt-lite__label{
  font-size:12px; color:#cbd5e1; padding:4px 8px;
  background:rgba(0,0,0,.35); border-radius:999px; margin-bottom:14px;
}
.yt-lite__play:hover .yt-lite__thumb{ filter:brightness(1); }

/* 特定箇所だけ狭めたいときに付ける */
.video.video--narrow, .video.video--narrow .yt-lite{
  max-width:720px !important; margin:12px auto !important;
}

/* ---------- Back to top ---------- */
.to-top{
  position:fixed; right:16px; bottom:16px; z-index:50;
  border:1px solid var(--border); background:var(--panel); color:var(--text);
  padding:10px 12px; border-radius:12px; cursor:pointer; box-shadow:var(--shadow);
  opacity:.9; transition: transform .2s ease, opacity .2s ease;
}
.to-top:hover{transform:translateY(-2px); opacity:1}

/* ---------- Footer ---------- */
.site-footer{border-top:1px solid var(--border); margin-top:40px; padding:24px 0; text-align:center; color:var(--muted)}
/* 図版を狭めて中央寄せにする（共通） */
.figure--narrow { max-width: 560px; margin: 12px auto; }
.figure--narrow img { width: 100%; height: auto; display: block; }
/* ===== PATCH: 図＋クイック解説の可読幅を保証 ===== */
.split{
  /* 好みで数値だけ調整OK */
  --fig-max: 560px;   /* 左：図の最大幅 */
  --aside-min: 360px; /* 右：解説の最小幅（←コイツがキモ） */
  display: grid;
  gap: 16px;
  grid-template-columns: minmax(320px, var(--fig-max)) minmax(var(--aside-min), 1fr);
  align-items: start;
}

/* 画面が少し狭いときは気持ちだけ緩める */
@media (max-width: 1100px){
  .split{ --fig-max: 520px; --aside-min: 320px; }
}

/* スマホは縦並びに */
@media (max-width: 820px){
  .split{ grid-template-columns: 1fr; }
}

/* 右側カードの中身（dt/dd）も詰まりにくくする */
.grade-notes{ min-width: var(--aside-min); }
.grade-list{
  display: grid;
  grid-template-columns: 5.8em minmax(0, 1fr); /* 左のラベルを少しだけ細く */
  column-gap: 12px;
  row-gap: 8px;
}
.grade-list dt{
  margin: 0;
  padding: .2em .6em;
  border: 1px solid var(--border);
  border-radius: 999px;
  text-align: center;
  font-weight: 700;
  background: #0f1522;
}
.grade-list dd{
  margin: 0;
  color: var(--muted);
  overflow-wrap: anywhere; /* 万一狭くても“つぶれず”折れる */
  line-height: 1.7;
}
/* === 左右の幅・高さ・余白を“完全に”合わせる === */
.split.split--tight{
  --fig-max: 520px;    /* 左の最大幅（560→520で右の可読幅を確保） */
  --aside-min: 400px;  /* 右の最小幅（日本語が縦落ちしない幅） */
  display:grid;
  gap:16px;
  grid-template-columns: minmax(320px, var(--fig-max)) minmax(var(--aside-min), 1fr);
  align-items: stretch;             /* ← 高さを揃える土台 */
}
.split.split--tight > *{ margin:0 } /* 子要素の外側余白をリセット */

@media (max-width:1100px){
  .split.split--tight{ --fig-max:500px; --aside-min:360px; }
}
@media (max-width:820px){
  .split.split--tight{ grid-template-columns:1fr; }
}

/* 等高を確実にするために内側をflex化 */
.cardify,
.grade-notes{
  display:flex;
  flex-direction:column;
  height:100%;               /* 親の stretch を受ける */
  padding:14px;              /* 左右の内側余白を統一 */
}

/* 図カードの見た目を右カードと完全同期 */
.cardify{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  box-shadow:var(--shadow);
}
.cardify img{ width:100%; height:auto; border-radius:12px; display:block; }
.cardify figcaption{ margin-top:10px; color:var(--muted); }

/* 右のタイトル余白を左に合わせる */
.grade-notes__title{ margin:4px 0 8px; font-size:16px; color:#cbd5e1; }

/* 用語集（dl）を読みやすく整形 */
.grade-list{
  display:grid;
  grid-template-columns: 6em minmax(0,1fr); /* 左ラベル固定、右本文は伸縮 */
  column-gap:12px;
  row-gap:10px;
  margin:0;
  padding:0;
}
.grade-list dt{
  margin:0;
  padding:.25em .6em;
  text-align:center;
  font-weight:700;
  border:1px solid var(--border);
  border-radius:999px;
  background:#0f1522;
}
.grade-list dd{
  margin:0;
  color:var(--muted);
  line-height:1.75;
  overflow-wrap:anywhere;    /* 狭い時も崩れない */
}

/* 必要なら右カードのフッター余白を押さえる（視覚中心揃え） */
.grade-notes{ justify-content:flex-start; }

/* スクロール時の視覚ズレを抑える（任意） */
.split--tight.equalize > *{ align-self:stretch; }
/* ピラミッド図に合わせる“短文×整列”専用 */
.grade-list--compact{
  display:grid;
  grid-template-columns: 7em minmax(0,1fr); /* 左幅を広げて改行防止 */
  column-gap:12px; row-gap:8px;
  margin:0; padding:0;
}
.grade-list--compact dt{
  margin:0; padding:.25em .6em; text-align:center; font-weight:700;
  border:1px solid var(--border); border-radius:999px; background:#0f1522;
}
.grade-list--compact dd{
  margin:0; color:var(--muted); line-height:1.75;
  display:-webkit-box; -webkit-box-orient:vertical;
  -webkit-line-clamp:2; overflow:hidden; /* 最大2行で省略 */
}
/* 図の最大幅を可変に（既存の .figure--narrow を上書き） */
.figure--narrow{
  max-width: min(var(--fig-max, 560px), 100%);
}

/* 図を大きめに見せたい区画用のプリセット（左：図を広げる） */
.split--figL{
  --fig-max: 640px;   /* ←好みで 600/620/680 などに調整 */
  --aside-min: 400px; /* 右カラムの最小幅。日本語が縦落ちしない幅を保証 */
}

/* 画面が少し狭いときは自動で少しだけ縮める（任意） */
@media (max-width: 1200px){
  .split--figL{ --fig-max: 600px; --aside-min: 380px; }
}
/* 2カラムを強制的に維持する安定版 */
.split--lock2{
  /* 左カラムは 300px〜図の最大値 までで、画面に合わせて伸縮 */
  grid-template-columns: clamp(300px, 42vw, var(--fig-max, 620px)) minmax(0, 1fr);
  align-items: start;
}

/* 右カラムの“最小幅縛り”を外して回り込みを防ぐ */
.split--lock2 .grade-notes{ min-width: 0 !important; }

/* 図の最大幅を変数で制御（既存の figure--narrow を変数対応に） */
.figure--narrow{ max-width: min(var(--fig-max, 560px), 100%); }

/* 図を少し大きめにするプリセット（必要に応じて値だけ調整） */
.split--figL{ --fig-max: 620px; }          /* 例: 620→640/600 に調整可 */

/* 画面が狭い時は自動で少しだけ縮める（任意） */
@media (max-width: 1200px){
  .split--figL{ --fig-max: 600px; }
}

/* スマホは縦積み */
@media (max-width: 820px){
  .split--lock2{ grid-template-columns: 1fr; }
}
/* ==== ピラミッド図セクション：横並びを絶対維持 ==== */
#gradeSplit{
  display:grid !important;
  gap:16px !important;
  /* 左右とも“最低幅”を持たせて2カラムを維持 */
  grid-template-columns:
    minmax(480px, 1fr)    /* 左：図は480px以上、余裕があれば広がる */
    minmax(420px, 1fr)    /* 右：解説は420px未満にしない＝縦落ち防止 */
  !important;
  align-items:start !important;
}

/* 右カラムの最小幅縛り・はみ出し対策 */
#gradeSplit .grade-notes{
  min-width:420px !important; /* 念のため二重で保証 */
  width:auto !important;
}

/* 左の図はラッパー幅にフィット（はみ出し防止） */
#gradeSplit .figure--narrow{ max-width:100% !important; }

/* 用語リストの列幅を右の可読性優先に調整 */
#gradeSplit .grade-list{
  grid-template-columns: 6.2em minmax(0, 1fr) !important;
}

/* 画面が狭くなったら縦積みへ切替 */
@media (max-width: 900px){
  #gradeSplit{
    grid-template-columns: 1fr !important;
  }
  #gradeSplit .grade-notes{ min-width:0 !important; }
}
